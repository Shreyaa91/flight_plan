/*!Raven.js 3.15.0 (b7e98e5) | github.com/getsentry/raven-js*/!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Raven=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){this.name="RavenConfigError",this.message=a}d.prototype=new Error,d.prototype.constructor=d,b.exports=d},{}],2:[function(a,b,c){"use strict";var d=function(a,b,c){var d=a[b],e=a;if(b in a){var f="warn"===b?"warning":b;a[b]=function(){var a=[].slice.call(arguments),b=""+a.join(" "),g={level:f,logger:"console",extra:{arguments:a}};c&&c(b,g),d&&Function.prototype.apply.call(d,e,a)}}};b.exports={wrapMethod:d}},{}],3:[function(a,b,c){(function(c){"use strict";function d(){return+new Date}function e(){this.a=!("object"!=typeof JSON||!JSON.stringify),this.b=!f(H),this.c=!f(I),this.d=null,this.e=null,this.f=null,this.g=null,this.h=null,this.i=null,this.j={},this.k={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],crossOrigin:"anonymous",collectWindowErrors:!0,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:!0,instrument:!0,sampleRate:1},this.l=0,this.m=!1,this.n=Error.stackTraceLimit,this.o=G.console||{},this.p={},this.q=[],this.r=d(),this.s=[],this.t=[],this.u=null,this.v=G.location,this.w=this.v&&this.v.href,this.x();for(var a in this.o)this.p[a]=this.o[a]}function f(a){return void 0===a}function g(a){return"function"==typeof a}function h(a){return"[object String]"===J.toString.call(a)}function i(a){for(var b in a)return!1;return!0}function j(a,b){var c,d;if(f(a.length))for(c in a)m(a,c)&&b.call(null,c,a[c]);else if(d=a.length)for(c=0;c<d;c++)b.call(null,c,a[c])}function k(a,b){return b?(j(b,function(b,c){a[b]=c}),a):a}function l(a,b){return!b||a.length<=b?a:a.substr(0,b)+"â€¦"}function m(a,b){return J.hasOwnProperty.call(a,b)}function n(a){for(var b,c=[],d=0,e=a.length;d<e;d++)b=a[d],h(b)?c.push(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):b&&b.source&&c.push(b.source);return new RegExp(c.join("|"),"i")}function o(a){var b=[];return j(a,function(a,c){b.push(encodeURIComponent(a)+"="+encodeURIComponent(c))}),b.join("&")}function p(a){var b=a.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!b)return{};var c=b[6]||"",d=b[8]||"";return{protocol:b[2],host:b[4],path:b[5],relative:b[5]+c+d}}function q(){var a=G.crypto||G.msCrypto;if(!f(a)&&a.getRandomValues){var b=new Uint16Array(8);a.getRandomValues(b),b[3]=4095&b[3]|16384,b[4]=16383&b[4]|32768;var c=function(a){for(var b=a.toString(16);b.length<4;)b="0"+b;return b};return c(b[0])+c(b[1])+c(b[2])+c(b[3])+c(b[4])+c(b[5])+c(b[6])+c(b[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function r(a){for(var b,c=5,d=80,e=[],f=0,g=0,h=" > ",i=h.length;a&&f++<c&&(b=s(a),!("html"===b||f>1&&g+e.length*i+b.length>=d));)e.push(b),g+=b.length,a=a.parentNode;return e.reverse().join(h)}function s(a){var b,c,d,e,f,g=[];if(!a||!a.tagName)return"";if(g.push(a.tagName.toLowerCase()),a.id&&g.push("#"+a.id),b=a.className,b&&h(b))for(c=b.split(/\s+/),f=0;f<c.length;f++)g.push("."+c[f]);var i=["type","name","title","alt"];for(f=0;f<i.length;f++)d=i[f],e=a.getAttribute(d),e&&g.push("["+d+'="'+e+'"]');return g.join("")}function t(a,b){return!!(!!a^!!b)}function u(a,b){return!t(a,b)&&(a=a.values[0],b=b.values[0],a.type===b.type&&a.value===b.value&&v(a.stacktrace,b.stacktrace))}function v(a,b){if(t(a,b))return!1;var c=a.frames,d=b.frames;if(c.length!==d.length)return!1;for(var e,f,g=0;g<c.length;g++)if(e=c[g],f=d[g],e.filename!==f.filename||e.lineno!==f.lineno||e.colno!==f.colno||e["function"]!==f["function"])return!1;return!0}function w(a,b,c,d){var e=a[b];a[b]=c(e),d&&d.push([a,b,e])}var x=a(6),y=a(7),z=a(1),A=a(5),B=A.isError,C=A.isObject,D=a(2).wrapMethod,E="source protocol user pass host port path".split(" "),F=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/,G="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},H=G.document,I=G.navigator;e.prototype={VERSION:"3.15.0",debug:!1,TraceKit:x,config:function(a,b){var c=this;if(c.g)return this.y("error","Error: Raven has already been configured"),c;if(!a)return c;var d=c.k;b&&j(b,function(a,b){"tags"===a||"extra"===a||"user"===a?c.j[a]=b:d[a]=b}),c.setDSN(a),d.ignoreErrors.push(/^Script error\.?$/),d.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),d.ignoreErrors=n(d.ignoreErrors),d.ignoreUrls=!!d.ignoreUrls.length&&n(d.ignoreUrls),d.whitelistUrls=!!d.whitelistUrls.length&&n(d.whitelistUrls),d.includePaths=n(d.includePaths),d.maxBreadcrumbs=Math.max(0,Math.min(d.maxBreadcrumbs||100,100));var e={xhr:!0,console:!0,dom:!0,location:!0},f=d.autoBreadcrumbs;"[object Object]"==={}.toString.call(f)?f=k(e,f):f!==!1&&(f=e),d.autoBreadcrumbs=f;var g={tryCatch:!0},h=d.instrument;return"[object Object]"==={}.toString.call(h)?h=k(g,h):h!==!1&&(h=g),d.instrument=h,x.collectWindowErrors=!!d.collectWindowErrors,c},install:function(){var a=this;return a.isSetup()&&!a.m&&(x.report.subscribe(function(){a.z.apply(a,arguments)}),a.k.instrument&&a.k.instrument.tryCatch&&a.A(),a.k.autoBreadcrumbs&&a.B(),a.C(),a.m=!0),Error.stackTraceLimit=a.k.stackTraceLimit,this},setDSN:function(a){var b=this,c=b.D(a),d=c.path.lastIndexOf("/"),e=c.path.substr(1,d);b.E=a,b.h=c.user,b.F=c.pass&&c.pass.substr(1),b.i=c.path.substr(d+1),b.g=b.G(c),b.H=b.g+"/"+e+"api/"+b.i+"/store/",this.x()},context:function(a,b,c){return g(a)&&(c=b||[],b=a,a=void 0),this.wrap(a,b).apply(this,c)},wrap:function(a,b,c){function d(){var d=[],f=arguments.length,h=!a||a&&a.deep!==!1;for(c&&g(c)&&c.apply(this,arguments);f--;)d[f]=h?e.wrap(a,arguments[f]):arguments[f];try{return b.apply(this,d)}catch(i){throw e.I(),e.captureException(i,a),i}}var e=this;if(f(b)&&!g(a))return a;if(g(a)&&(b=a,a=void 0),!g(b))return b;try{if(b.J)return b;if(b.K)return b.K}catch(h){return b}for(var i in b)m(b,i)&&(d[i]=b[i]);return d.prototype=b.prototype,b.K=d,d.J=!0,d.L=b,d},uninstall:function(){return x.report.uninstall(),this.M(),Error.stackTraceLimit=this.n,this.m=!1,this},captureException:function(a,b){if(!B(a))return this.captureMessage(a,k({trimHeadFrames:1,stacktrace:!0},b));this.d=a;try{var c=x.computeStackTrace(a);this.N(c,b)}catch(d){if(a!==d)throw d}return this},captureMessage:function(a,b){if(!this.k.ignoreErrors.test||!this.k.ignoreErrors.test(a)){b=b||{};var c=k({message:a+""},b);if(this.k.stacktrace||b&&b.stacktrace){var d;try{throw new Error(a)}catch(e){d=e}d.name=null,b=k({fingerprint:a,trimHeadFrames:(b.trimHeadFrames||0)+1},b);var f=x.computeStackTrace(d),g=this.O(f,b);c.stacktrace={frames:g.reverse()}}return this.P(c),this}},captureBreadcrumb:function(a){var b=k({timestamp:d()/1e3},a);if(g(this.k.breadcrumbCallback)){var c=this.k.breadcrumbCallback(b);if(C(c)&&!i(c))b=c;else if(c===!1)return this}return this.t.push(b),this.t.length>this.k.maxBreadcrumbs&&this.t.shift(),this},addPlugin:function(a){var b=[].slice.call(arguments,1);return this.q.push([a,b]),this.m&&this.C(),this},setUserContext:function(a){return this.j.user=a,this},setExtraContext:function(a){return this.Q("extra",a),this},setTagsContext:function(a){return this.Q("tags",a),this},clearContext:function(){return this.j={},this},getContext:function(){return JSON.parse(y(this.j))},setEnvironment:function(a){return this.k.environment=a,this},setRelease:function(a){return this.k.release=a,this},setDataCallback:function(a){var b=this.k.dataCallback;return this.k.dataCallback=g(a)?function(c){return a(c,b)}:a,this},setBreadcrumbCallback:function(a){var b=this.k.breadcrumbCallback;return this.k.breadcrumbCallback=g(a)?function(c){return a(c,b)}:a,this},setShouldSendCallback:function(a){var b=this.k.shouldSendCallback;return this.k.shouldSendCallback=g(a)?function(c){return a(c,b)}:a,this},setTransport:function(a){return this.k.transport=a,this},lastException:function(){return this.d},lastEventId:function(){return this.f},isSetup:function(){return!!this.a&&(!!this.g||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this.y("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var a=G.RavenConfig;a&&this.config(a.dsn,a.config).install()},showReportDialog:function(a){if(H){a=a||{};var b=a.eventId||this.lastEventId();if(!b)throw new z("Missing eventId");var c=a.dsn||this.E;if(!c)throw new z("Missing DSN");var d=encodeURIComponent,e="";e+="?eventId="+d(b),e+="&dsn="+d(c);var f=a.user||this.j.user;f&&(f.name&&(e+="&name="+d(f.name)),f.email&&(e+="&email="+d(f.email)));var g=this.G(this.D(c)),h=H.createElement("script");h.async=!0,h.src=g+"/api/embed/error-page/"+e,(H.head||H.body).appendChild(h)}},I:function(){var a=this;this.l+=1,setTimeout(function(){a.l-=1})},R:function(a,b){var c,d;if(this.b){b=b||{},a="raven"+a.substr(0,1).toUpperCase()+a.substr(1),H.createEvent?(c=H.createEvent("HTMLEvents"),c.initEvent(a,!0,!0)):(c=H.createEventObject(),c.eventType=a);for(d in b)m(b,d)&&(c[d]=b[d]);if(H.createEvent)H.dispatchEvent(c);else try{H.fireEvent("on"+c.eventType.toLowerCase(),c)}catch(e){}}},S:function(a){var b=this;return function(c){if(b.T=null,b.u!==c){b.u=c;var d;try{d=r(c.target)}catch(e){d="<unknown>"}b.captureBreadcrumb({category:"ui."+a,message:d})}}},U:function(){var a=this,b=1e3;return function(c){var d;try{d=c.target}catch(e){return}var f=d&&d.tagName;if(f&&("INPUT"===f||"TEXTAREA"===f||d.isContentEditable)){var g=a.T;g||a.S("input")(c),clearTimeout(g),a.T=setTimeout(function(){a.T=null},b)}}},V:function(a,b){var c=p(this.v.href),d=p(b),e=p(a);this.w=b,c.protocol===d.protocol&&c.host===d.host&&(b=d.relative),c.protocol===e.protocol&&c.host===e.host&&(a=e.relative),this.captureBreadcrumb({category:"navigation",data:{to:b,from:a}})},A:function(){function a(a){return function(b,d){for(var e=new Array(arguments.length),f=0;f<e.length;++f)e[f]=arguments[f];var h=e[0];return g(h)&&(e[0]=c.wrap(h)),a.apply?a.apply(this,e):a(e[0],e[1])}}function b(a){var b=G[a]&&G[a].prototype;b&&b.hasOwnProperty&&b.hasOwnProperty("addEventListener")&&(w(b,"addEventListener",function(b){return function(d,f,g,h){try{f&&f.handleEvent&&(f.handleEvent=c.wrap(f.handleEvent))}catch(i){}var j,k,l;return e&&e.dom&&("EventTarget"===a||"Node"===a)&&(k=c.S("click"),l=c.U(),j=function(a){if(a){var b;try{b=a.type}catch(c){return}return"click"===b?k(a):"keypress"===b?l(a):void 0}}),b.call(this,d,c.wrap(f,void 0,j),g,h)}},d),w(b,"removeEventListener",function(a){return function(b,c,d,e){try{c=c&&(c.K?c.K:c)}catch(f){}return a.call(this,b,c,d,e)}},d))}var c=this,d=c.s,e=this.k.autoBreadcrumbs;w(G,"setTimeout",a,d),w(G,"setInterval",a,d),G.requestAnimationFrame&&w(G,"requestAnimationFrame",function(a){return function(b){return a(c.wrap(b))}},d);for(var f=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],h=0;h<f.length;h++)b(f[h])},B:function(){function a(a,c){a in c&&g(c[a])&&w(c,a,function(a){return b.wrap(a)})}var b=this,c=this.k.autoBreadcrumbs,d=b.s;if(c.xhr&&"XMLHttpRequest"in G){var e=XMLHttpRequest.prototype;w(e,"open",function(a){return function(c,d){return h(d)&&d.indexOf(b.h)===-1&&(this.W={method:c,url:d,status_code:null}),a.apply(this,arguments)}},d),w(e,"send",function(c){return function(d){function e(){if(f.W&&(1===f.readyState||4===f.readyState)){try{f.W.status_code=f.status}catch(a){}b.captureBreadcrumb({type:"http",category:"xhr",data:f.W})}}for(var f=this,h=["onload","onerror","onprogress"],i=0;i<h.length;i++)a(h[i],f);return"onreadystatechange"in f&&g(f.onreadystatechange)?w(f,"onreadystatechange",function(a){return b.wrap(a,void 0,e)}):f.onreadystatechange=e,c.apply(this,arguments)}},d)}c.xhr&&"fetch"in G&&w(G,"fetch",function(a){return function(c,d){for(var e=new Array(arguments.length),f=0;f<e.length;++f)e[f]=arguments[f];var g,h=e[0],i="GET";"string"==typeof h?g=h:(g=h.url,h.method&&(i=h.method)),e[1]&&e[1].method&&(i=e[1].method);var j={method:i,url:g,status_code:null};return b.captureBreadcrumb({type:"http",category:"fetch",data:j}),a.apply(this,e).then(function(a){return j.status_code=a.status,a})}},d),c.dom&&this.b&&(H.addEventListener?(H.addEventListener("click",b.S("click"),!1),H.addEventListener("keypress",b.U(),!1)):(H.attachEvent("onclick",b.S("click")),H.attachEvent("onkeypress",b.U())));var f=G.chrome,i=f&&f.app&&f.app.runtime,k=!i&&G.history&&history.pushState;if(c.location&&k){var l=G.onpopstate;G.onpopstate=function(){var a=b.v.href;if(b.V(b.w,a),l)return l.apply(this,arguments)},w(history,"pushState",function(a){return function(){var c=arguments.length>2?arguments[2]:void 0;return c&&b.V(b.w,c+""),a.apply(this,arguments)}},d)}if(c.console&&"console"in G&&console.log){var m=function(a,c){b.captureBreadcrumb({message:a,level:c.level,category:"console"})};j(["debug","info","warn","error","log"],function(a,b){D(console,b,m)})}},M:function(){for(var a;this.s.length;){a=this.s.shift();var b=a[0],c=a[1],d=a[2];b[c]=d}},C:function(){var a=this;j(this.q,function(b,c){var d=c[0],e=c[1];d.apply(a,[a].concat(e))})},D:function(a){var b=F.exec(a),c={},d=7;try{for(;d--;)c[E[d]]=b[d]||""}catch(e){throw new z("Invalid DSN: "+a)}if(c.pass&&!this.k.allowSecretKey)throw new z("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return c},G:function(a){var b="//"+a.host+(a.port?":"+a.port:"");return a.protocol&&(b=a.protocol+":"+b),b},z:function(){this.l||this.N.apply(this,arguments)},N:function(a,b){var c=this.O(a,b);this.R("handle",{stackInfo:a,options:b}),this.X(a.name,a.message,a.url,a.lineno,c,b)},O:function(a,b){var c=this,d=[];if(a.stack&&a.stack.length&&(j(a.stack,function(a,b){var e=c.Y(b);e&&d.push(e)}),b&&b.trimHeadFrames))for(var e=0;e<b.trimHeadFrames&&e<d.length;e++)d[e].in_app=!1;return d=d.slice(0,this.k.stackTraceLimit)},Y:function(a){if(a.url){var b={filename:a.url,lineno:a.line,colno:a.column,"function":a.func||"?"};return b.in_app=!(this.k.includePaths.test&&!this.k.includePaths.test(b.filename)||/(Raven|TraceKit)\./.test(b["function"])||/raven\.(min\.)?js$/.test(b.filename)),b}},X:function(a,b,c,d,e,f){var g;if((!this.k.ignoreErrors.test||!this.k.ignoreErrors.test(b))&&(b+="",e&&e.length?(c=e[0].filename||c,e.reverse(),g={frames:e}):c&&(g={frames:[{filename:c,lineno:d,in_app:!0}]}),(!this.k.ignoreUrls.test||!this.k.ignoreUrls.test(c))&&(!this.k.whitelistUrls.test||this.k.whitelistUrls.test(c)))){var h=k({exception:{values:[{type:a,value:b,stacktrace:g}]},culprit:c},f);this.P(h)}},Z:function(a){var b=this.k.maxMessageLength;if(a.message&&(a.message=l(a.message,b)),a.exception){var c=a.exception.values[0];c.value=l(c.value,b)}var d=a.request;return d&&(d.url&&(d.url=l(d.url,this.k.maxUrlLength)),d.Referer&&(d.Referer=l(d.Referer,this.k.maxUrlLength))),a.breadcrumbs&&a.breadcrumbs.values&&this.$(a.breadcrumbs),a},$:function(a){for(var b,c,d,e=["to","from","url"],f=0;f<a.values.length;++f)if(c=a.values[f],c.hasOwnProperty("data")&&C(c.data)){d=c.data;for(var g=0;g<e.length;++g)b=e[g],d.hasOwnProperty(b)&&(d[b]=l(d[b],this.k.maxUrlLength))}},_:function(){if(this.c||this.b){var a={};return this.c&&I.userAgent&&(a.headers={"User-Agent":navigator.userAgent}),this.b&&(H.location&&H.location.href&&(a.url=H.location.href),H.referrer&&(a.headers||(a.headers={}),a.headers.Referer=H.referrer)),a}},x:function(){this.aa=0,this.ba=null},ca:function(){return this.aa&&d()-this.ba<this.aa},da:function(a){var b=this.e;return!(!b||a.message!==b.message||a.culprit!==b.culprit)&&(a.stacktrace||b.stacktrace?v(a.stacktrace,b.stacktrace):!a.exception&&!b.exception||u(a.exception,b.exception))},ea:function(a){if(!this.ca()){var b=a.status;if(400===b||401===b||429===b){var c;try{c=a.getResponseHeader("Retry-After"),c=1e3*parseInt(c,10)}catch(e){}this.aa=c?c:2*this.aa||1e3,this.ba=d()}}},P:function(a){var b=this.k,c={project:this.i,logger:b.logger,platform:"javascript"},e=this._();if(e&&(c.request=e),a.trimHeadFrames&&delete a.trimHeadFrames,a=k(c,a),a.tags=k(k({},this.j.tags),a.tags),a.extra=k(k({},this.j.extra),a.extra),a.extra["session:duration"]=d()-this.r,this.t&&this.t.length>0&&(a.breadcrumbs={values:[].slice.call(this.t,0)}),i(a.tags)&&delete a.tags,this.j.user&&(a.user=this.j.user),b.environment&&(a.environment=b.environment),b.release&&(a.release=b.release),b.serverName&&(a.server_name=b.serverName),g(b.dataCallback)&&(a=b.dataCallback(a)||a),a&&!i(a)&&(!g(b.shouldSendCallback)||b.shouldSendCallback(a)))return this.ca()?void this.y("warn","Raven dropped error due to backoff: ",a):void("number"==typeof b.sampleRate?Math.random()<b.sampleRate&&this.fa(a):this.fa(a))},ga:function(){return q()},fa:function(a,b){var c=this,d=this.k;if(this.isSetup()){if(this.f=a.event_id||(a.event_id=this.ga()),a=this.Z(a),!this.k.allowDuplicates&&this.da(a))return void this.y("warn","Raven dropped repeat event: ",a);this.e=a,this.y("debug","Raven about to send:",a);var e={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this.h};this.F&&(e.sentry_secret=this.F);var f=a.exception&&a.exception.values[0];this.captureBreadcrumb({category:"sentry",message:f?(f.type?f.type+": ":"")+f.value:a.message,event_id:a.event_id,level:a.level||"error"});var g=this.H;(d.transport||this.ha).call(this,{url:g,auth:e,data:a,options:d,onSuccess:function(){c.x(),c.R("success",{data:a,src:g}),b&&b()},onError:function(d){c.y("error","Raven transport failed to send: ",d),d.request&&c.ea(d.request),c.R("failure",{data:a,src:g}),d=d||new Error("Raven send failed (no additional details provided)"),b&&b(d)}})}},ha:function(a){var b=new XMLHttpRequest,c="withCredentials"in b||"undefined"!=typeof XDomainRequest;if(c){var d=a.url;"withCredentials"in b?b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status)a.onSuccess&&a.onSuccess();else if(a.onError){var c=new Error("Sentry error code: "+b.status);c.request=b,a.onError(c)}}:(b=new XDomainRequest,d=d.replace(/^https?:/,""),a.onSuccess&&(b.onload=a.onSuccess),a.onError&&(b.onerror=function(){var c=new Error("Sentry error code: XDomainRequest");c.request=b,a.onError(c)})),b.open("POST",d+"?"+o(a.auth)),b.send(y(a.data))}},y:function(a){this.p[a]&&this.debug&&Function.prototype.apply.call(this.p[a],this.o,[].slice.call(arguments,1))},Q:function(a,b){f(b)?delete this.j[a]:this.j[a]=k(this.j[a]||{},b)}};var J=Object.prototype;e.prototype.setUser=e.prototype.setUserContext,e.prototype.setReleaseContext=e.prototype.setRelease,b.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,2:2,5:5,6:6,7:7}],4:[function(a,b,c){(function(c){"use strict";var d=a(3),e="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},f=e.Raven,g=new d;g.noConflict=function(){return e.Raven=f,g},g.afterLoad(),b.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{3:3}],5:[function(a,b,c){"use strict";function d(a){return"object"==typeof a&&null!==a}function e(a){switch({}.toString.call(a)){case"[object Error]":return!0;case"[object Exception]":return!0;case"[object DOMException]":return!0;default:return a instanceof Error}}b.exports={isObject:d,isError:e}},{}],6:[function(a,b,c){(function(c){"use strict";function d(){return"undefined"==typeof document||"undefined"==typeof document.location?"":document.location.href}var e=a(5),f={collectWindowErrors:!0,debug:!1},g="undefined"!=typeof window?window:"undefined"!=typeof c?c:"undefined"!=typeof self?self:{},h=[].slice,i="?",j=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;f.report=function(){function a(a){m(),s.push(a)}function b(a){for(var b=s.length-1;b>=0;--b)s[b]===a&&s.splice(b,1)}function c(){n(),s=[]}function k(a,b){var c=null;if(!b||f.collectWindowErrors){for(var d in s)if(s.hasOwnProperty(d))try{s[d].apply(null,[a].concat(h.call(arguments,2)))}catch(e){c=e}if(c)throw c}}function l(a,b,c,g,h){var l=null;if(v)f.computeStackTrace.augmentStackTraceWithInitialElement(v,b,c,a),o();else if(h&&e.isError(h))l=f.computeStackTrace(h),k(l,!0);else{var m,n={url:b,line:c,column:g},p=void 0,r=a;if("[object String]"==={}.toString.call(a)){var m=a.match(j);m&&(p=m[1],r=m[2])}n.func=i,l={name:p,message:r,url:d(),stack:[n]},k(l,!0)}return!!q&&q.apply(this,arguments)}function m(){r||(q=g.onerror,g.onerror=l,r=!0)}function n(){r&&(g.onerror=q,r=!1,q=void 0)}function o(){var a=v,b=t;t=null,v=null,u=null,k.apply(null,[a,!1].concat(b))}function p(a,b){var c=h.call(arguments,1);if(v){if(u===a)return;o()}var d=f.computeStackTrace(a);if(v=d,u=a,t=c,setTimeout(function(){u===a&&o()},d.incomplete?2e3:0),b!==!1)throw a}var q,r,s=[],t=null,u=null,v=null;return p.subscribe=a,p.unsubscribe=b,p.uninstall=c,p}(),f.computeStackTrace=function(){function a(a){if("undefined"!=typeof a.stack&&a.stack){for(var b,c,e,f=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,g=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?)(?::(\d+))?(?::(\d+))?\s*$/i,h=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,j=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,k=/\((\S*)(?::(\d+))(?::(\d+))\)/,l=a.stack.split("\n"),m=[],n=(/^(.*) is undefined$/.exec(a.message),0),o=l.length;n<o;++n){if(c=f.exec(l[n])){var p=c[2]&&0===c[2].indexOf("native"),q=c[2]&&0===c[2].indexOf("eval");q&&(b=k.exec(c[2]))&&(c[2]=b[1],c[3]=b[2],c[4]=b[3]),e={url:p?null:c[2],func:c[1]||i,args:p?[c[2]]:[],line:c[3]?+c[3]:null,column:c[4]?+c[4]:null}}else if(c=h.exec(l[n]))e={url:c[2],func:c[1]||i,args:[],line:+c[3],column:c[4]?+c[4]:null};else{if(!(c=g.exec(l[n])))continue;var q=c[3]&&c[3].indexOf(" > eval")>-1;q&&(b=j.exec(c[3]))?(c[3]=b[1],c[4]=b[2],c[5]=null):0!==n||c[5]||"undefined"==typeof a.columnNumber||(m[0].column=a.columnNumber+1),e={url:c[3],func:c[1]||i,args:c[2]?c[2].split(","):[],line:c[4]?+c[4]:null,column:c[5]?+c[5]:null}}!e.func&&e.line&&(e.func=i),m.push(e)}return m.length?{name:a.name,message:a.message,url:d(),stack:m}:null}}function b(a,b,c,d){var e={url:b,line:c};if(e.url&&e.line){if(a.incomplete=!1,e.func||(e.func=i),a.stack.length>0&&a.stack[0].url===e.url){if(a.stack[0].line===e.line)return!1;if(!a.stack[0].line&&a.stack[0].func===e.func)return a.stack[0].line=e.line,!1}return a.stack.unshift(e),a.partial=!0,!0}return a.incomplete=!0,!1}function c(a,g){for(var h,j,k=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,l=[],m={},n=!1,o=c.caller;o&&!n;o=o.caller)if(o!==e&&o!==f.report){if(j={url:null,func:i,line:null,column:null},o.name?j.func=o.name:(h=k.exec(o.toString()))&&(j.func=h[1]),"undefined"==typeof j.func)try{j.func=h.input.substring(0,h.input.indexOf("{"))}catch(p){}m[""+o]?n=!0:m[""+o]=!0,l.push(j)}g&&l.splice(0,g);var q={name:a.name,message:a.message,url:d(),stack:l};return b(q,a.sourceURL||a.fileName,a.line||a.lineNumber,a.message||a.description),q}function e(b,e){var g=null;e=null==e?0:+e;try{if(g=a(b))return g}catch(h){if(f.debug)throw h}try{if(g=c(b,e+1))return g}catch(h){if(f.debug)throw h}return{name:b.name,message:b.message,url:d()}}return e.augmentStackTraceWithInitialElement=b,e.computeStackTraceFromStackProp=a,e}(),b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{5:5}],7:[function(a,b,c){"use strict";function d(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function e(a,b,c,d){return JSON.stringify(a,f(b,d),c)}function f(a,b){var c=[],e=[];return null==b&&(b=function(a,b){return c[0]===b?"[Circular ~]":"[Circular ~."+e.slice(0,d(c,b)).join(".")+"]"}),function(f,g){if(c.length>0){var h=d(c,this);~h?c.splice(h+1):c.push(this),~h?e.splice(h,1/0,f):e.push(f),~d(c,g)&&(g=b.call(this,f,g))}else c.push(g);return null==a?g:a.call(this,f,g)}}c=b.exports=e,c.getSerialize=f},{}]},{},[4])(4)});var simpleGetJSON=function(url,success,failure){var request=new XMLHttpRequest();request.open('GET',url,true);request.onload=function(){if(this.status>=200&&this.status<400){if(success)success(JSON.parse(this.responseText));}else{if(failure){failure(request);}else{throw "Failed to fetch "+url+'. State: '+request.readyState+'. Status: '+request.status;}}};request.onerror=failure||function(e){throw e;};request.send();}
document.addEventListener('DOMContentLoaded',function(){var cookieEl=document.querySelector('.cookie-consent');if(!cookieEl)return;if(document.cookie.indexOf('cookieconsent=1')===-1){cookieEl.style.display='block';}
cookieEl.addEventListener('click',function(){cookieEl.style.display='none';document.cookie='cookieconsent=1; max-age=31536000; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/';});});document.addEventListener('DOMContentLoaded',function(){var accountDropdownVisible=false;var accountDropdown=document.getElementById('account-dropdown');document.getElementById('navigation-login').addEventListener('click',function(ev){if(accountDropdownVisible){accountDropdown.style.display='none';}else{accountDropdown.style.display='block';}
accountDropdownVisible=!accountDropdownVisible;ev.preventDefault();ev.stopPropagation();});document.addEventListener('click',function(ev){if(accountDropdownVisible&&ev.target!==accountDropdown&&!accountDropdown.contains(ev.target)){accountDropdown.style.display='none';ev.preventDefault();ev.stopPropagation();accountDropdownVisible=!accountDropdownVisible;}},true);var _csrf=document.getElementById('_csrf').innerText||document.getElementById('_csrf').textContent;var likeButtons=document.querySelectorAll('.like-button');[].forEach.call(likeButtons,function(likeButton){var inProgress=false;var addingLike=false;likeButton.addEventListener('click',function(){if(!inProgress&&likeButton.dataset.liked){if(likeButton.dataset.liked=='true'){likeButton.dataset.liked='false';likeButton.classList.remove('like-button-liked');}else{likeButton.dataset.liked='true';addingLike=true;}
likeButton.classList.add('like-button-inprogress');likeButton.innerHTML='&#9825;';inProgress=true;var data={};data.id=~~likeButton.dataset.planid;data._csrf=_csrf;var likeXHR=new XMLHttpRequest();likeXHR.open('POST','/data/plan/like');likeXHR.setRequestHeader('Content-Type','application/json');likeXHR.onload=function(){if(likeXHR.status===200){if(JSON.parse(likeXHR.responseText).liked==true){likeButton.classList.add('like-button-liked');likeButton.innerHTML='&#9825;';}else{likeButton.innerHTML='&#9825;';}
likeButton.classList.remove('like-button-inprogress');inProgress=false;}}
likeXHR.send(JSON.stringify(data));}})});var deleteButtons=document.querySelectorAll('.delete-button');[].forEach.call(deleteButtons,function(deleteButton){var inProgress=false;deleteButton.addEventListener('click',function(){if(!inProgress&&deleteButton.dataset.planid){var doDelete=window.confirm("Are you sure you wish to delete this plan?");if(doDelete){deleteButton.innerHTML='Deleting';inProgress=true;var data={};data.id=~~deleteButton.dataset.planid;data._csrf=_csrf;var deleteXHR=new XMLHttpRequest();deleteXHR.open('POST','/data/plan/delete');deleteXHR.setRequestHeader('Content-Type','application/json');deleteXHR.onload=function(){if(deleteXHR.status===200){if(JSON.parse(deleteXHR.responseText).success==true){var results=document.getElementsByClassName('result');if(results.length>0){[].forEach.call(results,function(result){if(result.dataset.planid==deleteButton.dataset.planid){result.parentNode.removeChild(result);}});}else{document.getElementById('main').innerHTML='<div class="center">Plan deleted</div>';}}else{deleteButton.innerHTML='Delete';}
inProgress=false;}}
deleteXHR.send(JSON.stringify(data));}}})});if(document.getElementById('share-fb')){document.getElementById('share-fb').addEventListener('click',function(){ga('send','social','facebook','like',window.location.toString());});}
if(document.getElementById('share-twitter')){document.getElementById('share-twitter').addEventListener('click',function(){ga('send','social','twitter','tweet',window.location.toString());});}
if(document.getElementById('share-twitter')){document.getElementById('share-google').addEventListener('click',function(){ga('send','social','g+','share',window.location.toString());});}});(function(){var AbstractChosen,DOM,Events,SelectParser,Util,emulated_event_mapped_to,emulated_events,is_emulated_event,temp_el,unwrap_emulated_event,wrap_emulated_event,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;};AbstractChosen=(function(){function AbstractChosen(form_field,options){this.form_field=form_field;this.options=options!=null?options:{};if(!AbstractChosen.browser_is_supported()){return;}
this.is_multiple=this.form_field.multiple;this.set_default_text();this.set_default_values();this.setup();this.set_up_html();this.register_observers();this.finish_setup();}
AbstractChosen.prototype.set_default_values=function(){var _this=this;this.click_test_action=function(evt){return _this.test_active_click(evt);};this.activate_action=function(evt){return _this.activate_field(evt);};this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=(this.options.allow_single_deselect!=null)&&(this.form_field.options[0]!=null)&&this.form_field.options[0].text===""?this.options.allow_single_deselect:false;this.disable_search_threshold=this.options.disable_search_threshold||0;this.disable_search=this.options.disable_search||false;this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:true;this.group_search=this.options.group_search!=null?this.options.group_search:true;this.search_contains=this.options.search_contains||false;this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:true;this.max_selected_options=this.options.max_selected_options||Infinity;return this.inherit_select_classes=this.options.inherit_select_classes||false;};AbstractChosen.prototype.set_default_text=function(){if(this.form_field.getAttribute("data-placeholder")){this.default_text=this.form_field.getAttribute("data-placeholder");}else if(this.is_multiple){this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||AbstractChosen.default_multiple_text;}else{this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||AbstractChosen.default_single_text;}
return this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||AbstractChosen.default_no_result_text;};AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=true;};AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=false;};AbstractChosen.prototype.input_focus=function(evt){var _this=this;if(this.is_multiple){if(!this.active_field){return setTimeout((function(){return _this.container_mousedown();}),50);}}else{if(!this.active_field){return this.activate_field();}}};AbstractChosen.prototype.input_blur=function(evt){var _this=this;if(!this.mouse_on_container){this.active_field=false;return setTimeout((function(){return _this.blur_test();}),100);}};AbstractChosen.prototype.results_option_build=function(options){var content,data,_i,_len,_ref;content='';_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group&&(data.search_match||data.group_match)){content+=this.result_add_group(data);}else if(!data.empty&&data.search_match){content+=this.result_add_option(data);}
if(options!=null?options.first:void 0){if(data.selected&&this.is_multiple){this.choice_build(data);}else if(data.selected&&!this.is_multiple){this.single_set_selected_text(data.text);}}}
return content;};AbstractChosen.prototype.result_add_option=function(option){var classes,style;classes=[];if(!option.disabled&&!(option.selected&&this.is_multiple)){classes.push("active-result");}
if(option.disabled&&!(option.selected&&this.is_multiple)){classes.push("disabled-result");}
if(option.selected){classes.push("result-selected");}
if(option.group_array_index!=null){classes.push("group-option");}
if(option.classes!==""){classes.push(option.classes);}
style=option.style.cssText!==""?" style=\""+option.style+"\"":"";return "<li class=\""+(classes.join(' '))+"\""+style+" data-option-array-index=\""+option.array_index+"\">"+option.search_text+"</li>";};AbstractChosen.prototype.result_add_group=function(group){return "<li class=\"group-result\">"+group.search_text+"</li>";};AbstractChosen.prototype.results_update_field=function(){this.set_default_text();if(!this.is_multiple){this.results_reset_cleanup();}
this.result_clear_highlight();this.result_single_selected=null;this.results_build();if(this.results_showing){return this.winnow_results();}};AbstractChosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide();}else{return this.results_show();}};AbstractChosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results();}else{return this.results_show();}};AbstractChosen.prototype.winnow_results=function(){var option,regex,regexAnchor,results,searchText,startpos,text,zregex,_i,_len,_ref;this.no_results_clear();results=0;searchText=this.get_search_text();regexAnchor=this.search_contains?"":"^";regex=new RegExp(regexAnchor+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.empty){if(option.group){option.group_match=false;}
if(!(option.group&&!this.group_search)){option.search_match=false;option.search_text=option.group?option.label:option.html;option.search_match=this.search_string_match(option.search_text,regex);if(option.search_match){results+=1;}
if(option.search_match){if(searchText.length){startpos=option.search_text.search(zregex);text=option.search_text.substr(0,startpos+searchText.length)+'</em>'+option.search_text.substr(startpos+searchText.length);option.search_text=text.substr(0,startpos)+'<em>'+text.substr(startpos);}
if(option.group_array_index!=null){this.results_data[option.group_array_index].group_match=true;}}else if((option.group_array_index!=null)&&this.results_data[option.group_array_index].search_match){option.search_match=true;}}}}
if(results<1&&searchText.length){this.update_results_content("");this.result_clear_highlight();return this.no_results(searchText);}else{this.update_results_content(this.results_option_build());return this.winnow_results_set_highlight();}};AbstractChosen.prototype.search_string_match=function(search_string,regex){var part,parts,_i,_len;if(regex.test(search_string)){return true;}else if(this.enable_split_word_search&&(search_string.indexOf(" ")>=0||search_string.indexOf("[")===0)){parts=search_string.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];if(regex.test(part)){return true;}}}}};AbstractChosen.prototype.choices_count=function(){var option,_i,_len,_ref;if(this.selected_option_count!=null){return this.selected_option_count;}
this.selected_option_count=0;_ref=this.form_field.options;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(option.selected){this.selected_option_count+=1;}}
return this.selected_option_count;};AbstractChosen.prototype.choices_click=function(evt){evt.preventDefault();if(!(this.results_showing||this.is_disabled)){return this.results_show();}};AbstractChosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0){return this.keydown_backstroke();}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search();}
break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt);}
break;case 27:if(this.results_showing){this.results_hide();}
return true;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search();}};AbstractChosen.prototype.container_width=function(){if(this.options.width!=null){return this.options.width;}else{return ""+this.form_field.offsetWidth+"px";}};AbstractChosen.browser_is_supported=function(){var _ref;if(window.navigator.appName==="Microsoft Internet Explorer"){return(null!==(_ref=document.documentMode)&&_ref>=8);}
return true;};AbstractChosen.default_multiple_text="Select Some Options";AbstractChosen.default_single_text="Select an Option";AbstractChosen.default_no_result_text="No results match";return AbstractChosen;})();temp_el=document.createElement('div');DOM={find_parent:function(el,check){var result;result=DOM.find_traversal(el,'parentNode',function(el){return el===document||check(el);});if(result===document){return null;}else{return result;}},find_next_sibling:function(el,check){return DOM.find_traversal(el,'nextSibling',check);},find_prev_sibling:function(el,check){return DOM.find_traversal(el,'previousSibling',check);},find_traversal:function(el,property,check){var current;current=el[property];while(!(current===null||check(current))){current=current[property];}
return current;}};if('classList'in temp_el){DOM.has_class=function(el,class_name){return el.classList.contains(class_name);};DOM.add_class=function(el,class_name){return el.classList.add(class_name);};DOM.remove_class=function(el,class_name){return el.classList.remove(class_name);};}else{DOM.has_class=function(el,class_name){return(" "+(el.className.toUpperCase())+" ").indexOf(" "+(class_name.toUpperCase())+" ")>-1;};DOM.add_class=function(el,class_name){if(!DOM.has_class(el,class_name)){return el.className+=" "+class_name;}};DOM.remove_class=function(el,class_name){return el.className=Util.trim((" "+el.className+" ").replace(" "+class_name,""));};}
if('getComputedStyle'in window){DOM.get_style=function(el,prop){return window.getComputedStyle(el,null).getPropertyValue(prop);};}else if('currentStyle'in temp_el){DOM.get_style=function(el,prop){return el.currentStyle[Util.camel_case(prop)];};}else{DOM.get_style=function(el,prop){return "";};}
temp_el=null;Events={};if(document.addEventListener!=null){Events.add=function(el,type,fn){if(is_emulated_event(type)){fn=wrap_emulated_event(el,type,fn);type=emulated_event_mapped_to(type);}
return el.addEventListener(type,fn,false);};Events.remove=function(el,type,fn){if(is_emulated_event(type)){fn=unwrap_emulated_event(el,type,fn);type=emulated_event_mapped_to(type);}
return el.removeEventListener(type,fn,false);};}else if(document.attachEvent!=null){Events.add=function(el,type,fn){var handler;handler=el['eventhandler'+type+fn]=function(){var evt;evt=window.event;evt.target=evt.srcElement;evt.currentTarget=el;evt.preventDefault=function(){return evt.returnValue=false;};evt.stopPropagation=function(){return evt.cancelBubble=true;};return fn.call(el,evt);};return el.attachEvent('on'+type,handler);};Events.remove=function(el,type,fn){var handler;handler=el['eventhandler'+type+fn];el.detachEvent('on'+type,handler);return el['eventhandler'+type+fn]=null;};}
if(document.createEvent!=null){Events.fire=function(el,type,memo){var event;if(memo==null){memo={};}
event=document.createEvent("HTMLEvents");event.initEvent(type,true,true);event.eventName=type;event.memo=memo;return el.dispatchEvent(event);};}else if(document.createEventObject!=null){Events.fire=function(el,type,memo){var event;if(memo==null){memo={};}
if(type.indexOf(':')>-1){return;}
event=document.createEventObject();event.eventType=type;event.eventName=type;event.memo=memo;return el.fireEvent("on"+type,event);};}
is_emulated_event=function(type){return emulated_events[type]!=null;};emulated_event_mapped_to=function(type){return emulated_events[type].mapped_to;};wrap_emulated_event=function(el,type,fn){var wrapped_fn_key;wrapped_fn_key=""+type+"_"+fn;if(el._chosen_wrapped==null){el._chosen_wrapped={};}
if(el._chosen_wrapped[wrapped_fn_key]==null){el._chosen_wrapped[wrapped_fn_key]=emulated_events[type].handler(el,fn);}
return el._chosen_wrapped[wrapped_fn_key];};unwrap_emulated_event=function(el,type,fn){var wrapped_fn,wrapped_fn_key;wrapped_fn_key=""+type+"_"+fn;wrapped_fn=wrap_emulated_event(el,type,fn);el._chosen_wrapped[wrapped_fn_key]=null;return wrapped_fn;};emulated_events={mouseenter:{mapped_to:'mouseover',handler:function(original_el,fn){return function(evt){if(original_el===evt.relatedTarget||((evt.relatedTarget!=null)&&DOM.find_parent(evt.relatedTarget,function(el){return el===original_el;}))){return;}
return fn.call(this,evt);};}}};emulated_events.mouseleave={mapped_to:'mouseout',handler:emulated_events.mouseenter.handler};SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[];}
SelectParser.prototype.add_node=function(child){if(child.nodeName.toUpperCase()==="OPTGROUP"){return this.add_group(child);}else{return this.add_option(child);}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:this.escapeExpression(group.label),children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled));}
return _results;};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName.toUpperCase()==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1;}
this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText});}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});}
return this.options_index+=1;}};SelectParser.prototype.escapeExpression=function(text){var map,unsafe_chars;if((text==null)||text===false){return "";}
if(!/[\&\<\>\"\'\`]/.test(text)){return text;}
map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};unsafe_chars=/&(?!\w+;)|[\<\>\"\'\`]/g;return text.replace(unsafe_chars,function(chr){return map[chr]||"&amp;";});};return SelectParser;})();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser();_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child);}
return parser.parsed;};Util={camel_case:function(string){return string.replace(/-([a-z])/g,function(match){return match[1].toUpperCase();});}};if(String.prototype.trim!=null){Util.trim=function(string){return string.trim();};}else{Util.trim=function(string){return string.replace(/^\s+|\s+$/g,'');};}
this.Chosen=(function(_super){__extends(Chosen,_super);function Chosen(){_ref=Chosen.__super__.constructor.apply(this,arguments);return _ref;}
Chosen.prototype.setup=function(){this.current_selectedIndex=this.form_field.selectedIndex;return this.is_rtl=DOM.has_class(this.form_field,"chzn-rtl");};Chosen.prototype.finish_setup=function(){return DOM.add_class(this.form_field,"chzn-done");};Chosen.prototype.set_up_html=function(){var container_classes,container_props,key,value;container_classes=["chzn-container"];container_classes.push("chzn-container-"+(this.is_multiple?"multi":"single"));if(this.inherit_select_classes&&this.form_field.className){container_classes.push(this.form_field.className);}
if(this.is_rtl){container_classes.push("chzn-rtl");}
container_props={'class':container_classes.join(' '),'style':"width: "+(this.container_width())+";",'title':this.form_field.title};if(this.form_field.id.length){container_props.id=this.form_field.id.replace(/[^\w]/g,'_')+"_chzn";}
this.container=document.createElement('div');for(key in container_props){value=container_props[key];this.container.setAttribute(key,value);}
if(this.is_multiple){this.container.innerHTML='<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop"><ul class="chzn-results"></ul></div>';}else{this.container.innerHTML='<a href="javascript:void(0)" class="chzn-single chzn-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>';}
this.form_field.style.display='none';this.form_field.parentNode.appendChild(this.container);this.dropdown=this.container.querySelector('div.chzn-drop');this.search_field=this.container.getElementsByTagName('input')[0];this.search_results=this.container.querySelector('ul.chzn-results');this.search_field_scale();this.search_no_results=this.container.querySelector('li.no-results');if(this.is_multiple){this.search_choices=this.container.querySelector('ul.chzn-choices');this.search_container=this.container.querySelector('li.search-field');}else{this.search_container=this.container.querySelector('div.chzn-search');this.selected_item=this.container.querySelector('.chzn-single');}
this.results_build();this.set_tab_index();this.set_label_behavior();return Events.fire(this.form_field,"liszt:ready",{chosen:this});};Chosen.prototype.register_observers=function(){var _this=this;Events.add(this.container,'mousedown',function(evt){_this.container_mousedown(evt);});Events.add(this.container,'mouseup',function(evt){_this.container_mouseup(evt);});Events.add(this.container,'mouseenter',function(evt){_this.mouse_enter(evt);});Events.add(this.container,'mouseleave',function(evt){_this.mouse_leave(evt);});Events.add(this.search_results,"mouseup",function(evt){_this.search_results_mouseup(evt);});Events.add(this.search_results,"mouseover",function(evt){_this.search_results_mouseover(evt);});Events.add(this.search_results,"mouseout",function(evt){_this.search_results_mouseout(evt);});Events.add(this.search_results,'mousewheel DOMMouseScroll',function(evt){_this.search_results_mousewheel(evt);});Events.add(this.form_field,"liszt:updated",function(evt){_this.results_update_field(evt);});Events.add(this.form_field,"liszt:activate",function(evt){_this.activate_field(evt);});Events.add(this.form_field,"liszt:open",function(evt){_this.container_mousedown(evt);});Events.add(this.search_field,"blur",function(evt){_this.input_blur(evt);});Events.add(this.search_field,"keyup",function(evt){_this.keyup_checker(evt);});Events.add(this.search_field,"keydown",function(evt){_this.keydown_checker(evt);});Events.add(this.search_field,"focus",function(evt){_this.input_focus(evt);});if(this.is_multiple){return Events.add(this.search_choices,"click",function(evt){_this.choices_click(evt);});}else{return Events.add(this.container,"click",function(evt){evt.preventDefault();});}};Chosen.prototype.search_field_disabled=function(){this.is_disabled=this.form_field.disabled;if(this.is_disabled){DOM.add_class(this.container,'chzn-disabled');this.search_field.disabled=true;if(!this.is_multiple){Events.remove(this.selected_item,"focus",this.activate_action);}
return this.close_field();}else{DOM.remove_class(this.container,'chzn-disabled');this.search_field.disabled=false;if(!this.is_multiple){return Events.add(this.selected_item,"focus",this.activate_action);}}};Chosen.prototype.container_mousedown=function(evt){if(!this.is_disabled){if(evt&&evt.type==="mousedown"&&!this.results_showing){evt.preventDefault();}
if(!((evt!=null)&&DOM.has_class(evt.target,"search-choice-close"))){if(!this.active_field){if(this.is_multiple){this.search_field.value="";}
Events.add(document,"click",this.click_test_action);this.results_show();}else if(!this.is_multiple&&evt&&((evt.target===this.selected_item)||(DOM.find_parent(evt.target,function(el){return DOM.has_class(el,"chzn-single");})!=null))){evt.preventDefault();this.results_toggle();}
return this.activate_field();}}};Chosen.prototype.container_mouseup=function(evt){if(evt.target.nodeName==="ABBR"&&!this.is_disabled){return this.results_reset(evt);}};Chosen.prototype.search_results_mousewheel=function(evt){var delta,_ref1,_ref2;delta=-((_ref1=evt.originalEvent)!=null?_ref1.wheelDelta:void 0)||((_ref2=evt.originialEvent)!=null?_ref2.detail:void 0);if(delta!=null){evt.preventDefault();if(evt.type==='DOMMouseScroll'){delta=delta*40;}
return this.search_results.scrollTop(delta+this.search_results.scrollTop());}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&DOM.has_class(this.container,"chzn-container-active")){return this.close_field();}};Chosen.prototype.close_field=function(){Events.remove(document,"click",this.click_test_action);this.active_field=false;this.results_hide();DOM.remove_class(this.container,"chzn-container-active");this.clear_backstroke();this.show_search_field_default();return this.search_field_scale();};Chosen.prototype.activate_field=function(){DOM.add_class(this.container,"chzn-container-active");this.active_field=true;this.search_field.value=this.search_field.value;return this.search_field.focus();};Chosen.prototype.test_active_click=function(evt){var selected_container;selected_container=DOM.find_parent(evt.target.parentNode,function(el){return DOM.has_class(el,'chzn-container');});if(this.container===selected_container){return this.active_field=true;}else{return this.close_field();}};Chosen.prototype.results_build=function(){var el,_i,_len,_ref1;this.parsing=true;this.selected_option_count=null;this.results_data=SelectParser.select_to_array(this.form_field);if(this.is_multiple){_ref1=this.search_choices.querySelectorAll("li.search-choice");for(_i=0,_len=_ref1.length;_i<_len;_i++){el=_ref1[_i];el.parentNode.removeChild(el);}}else if(!this.is_multiple){this.single_set_selected_text();if(this.disable_search||this.form_field.options.length<=this.disable_search_threshold){this.search_field.readOnly=true;DOM.add_class(this.container,"chzn-container-single-nosearch");}else{this.search_field.readOnly=false;DOM.remove_class(this.container,"chzn-container-single-nosearch");}}
this.update_results_content(this.results_option_build({first:true}));this.search_field_disabled();this.show_search_field_default();this.search_field_scale();return this.parsing=false;};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el!=null){this.result_clear_highlight();this.result_highlight=el;DOM.add_class(this.result_highlight,"highlighted");maxHeight=parseInt(DOM.get_style(this.search_results,'max-height'),10);visible_top=this.search_results.scrollTop;visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.offsetTop;high_bottom=high_top+this.result_highlight.clientHeight;if(high_bottom>=visible_bottom){return this.search_results.scrollTop=(high_bottom-maxHeight)>0?high_bottom-maxHeight:0;}else if(high_top<visible_top){return this.search_results.scrollTop=high_top;}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){DOM.remove_class(this.result_highlight,"highlighted");}
return this.result_highlight=null;};Chosen.prototype.results_show=function(){if(this.is_multiple&&this.max_selected_options<=this.choices_count()){Events.fire(this.form_field,"liszt:maxselected",{chosen:this});return false;}
DOM.add_class(this.container,"chzn-with-drop");Events.fire(this.form_field,"liszt:showing_dropdown",{chosen:this});this.results_showing=true;this.search_field.focus();this.search_field.value=this.search_field.value;return this.winnow_results();};Chosen.prototype.update_results_content=function(content){return this.search_results.innerHTML=content;};Chosen.prototype.results_hide=function(){if(this.results_showing){this.result_clear_highlight();DOM.remove_class(this.container,"chzn-with-drop");Events.fire(this.form_field,"liszt:hiding_dropdown",{chosen:this});}
return this.results_showing=false;};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field.tabindex){ti=this.form_field.tabindex;this.form_field.tabindex=-1;return this.search_field.tabindex=ti;}};Chosen.prototype.set_label_behavior=function(){var _this=this;this.form_field_label=DOM.find_parent(this.form_field,function(el){return el.nodeName.toUpperCase()==='LABEL';});if((this.form_field_label==null)&&this.form_field.id.length){this.form_field_label=document.querySelector("label[for='"+this.form_field.id+"']");}
if(this.form_field_label!=null){return this.form_field_label.click(function(evt){if(_this.is_multiple){return _this.container_mousedown(evt);}else{return _this.activate_field();}});}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices_count()<1&&!this.active_field){this.search_field.value=this.default_text;return DOM.add_class(this.search_field,"default");}else{this.search_field.value="";return DOM.remove_class(this.search_field,"default");}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=DOM.has_class(evt.target,"active-result")?evt.target:DOM.find_parent(evt.target,function(el){return DOM.has_class(el,"active-result");});if(target!=null){this.result_highlight=target;this.result_select(evt);return this.search_field.focus();}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=DOM.has_class(evt.target,"active-result")?evt.target:DOM.find_parent(evt.target,function(el){return DOM.has_class(el,"active-result");});if(target){return this.result_do_highlight(target);}};Chosen.prototype.search_results_mouseout=function(evt){if(DOM.has_class(evt.target,"active-result"||DOM.find_parent(evt.target,function(el){return DOM.has_class(el,"active-result");}))){return this.result_clear_highlight();}};Chosen.prototype.choice_build=function(item){var choice,close_link,_this=this;choice=document.createElement('li');choice.className="search-choice";choice.innerHTML="<span>"+item.html+"</span>";if(item.disabled){DOM.add_class(choice,'search-choice-disabled');}else{close_link=document.createElement('a');close_link.href='#';close_link.className='search-choice-close';close_link.rel=item.array_index;Events.add(close_link,'click',function(evt){return _this.choice_destroy_link_click(evt);});choice.appendChild(close_link);}
return this.search_container.parentNode.insertBefore(choice,this.search_container);};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();evt.stopPropagation();if(!this.is_disabled){return this.choice_destroy(evt.target);}};Chosen.prototype.choice_destroy=function(link){var li;if(this.result_deselect(link.getAttribute("rel"))){this.show_search_field_default();if(this.is_multiple&&this.choices_count()>0&&this.search_field.value.length<1){this.results_hide();}
li=DOM.find_parent(link,function(el){return el.nodeName.toUpperCase()==='LI';});if(li!=null){li.parentNode.removeChild(li);}
return this.search_field_scale();}};Chosen.prototype.results_reset=function(){this.form_field.options[0].selected=true;this.selected_option_count=null;this.single_set_selected_text();this.show_search_field_default();this.results_reset_cleanup();Events.fire(this.form_field,"change");if(this.active_field){return this.results_hide();}};Chosen.prototype.results_reset_cleanup=function(){var abbr;this.current_selectedIndex=this.form_field.selectedIndex;abbr=this.selected_item.getElementsByTagName("abbr")[0];return abbr.parentNode.removeChild(abbr);};Chosen.prototype.result_select=function(evt){var el,high,item,_i,_len,_ref1;if(this.result_highlight){high=this.result_highlight;this.result_clear_highlight();if(this.is_multiple&&this.max_selected_options<=this.choices_count()){Events.fire(this.form_field,"liszt:maxselected",{chosen:this});return false;}
if(this.is_multiple){DOM.remove_class(high,"active-result");}else{_ref1=this.search_results.querySelectorAll(".result-selected");for(_i=0,_len=_ref1.length;_i<_len;_i++){el=_ref1[_i];DOM.remove_class(el,"result-selected");}
this.result_single_selected=high;}
DOM.add_class(high,"result-selected");item=this.results_data[high.getAttribute("data-option-array-index")];item.selected=true;this.form_field.options[item.options_index].selected=true;this.selected_option_count=null;if(this.is_multiple){this.choice_build(item);}else{this.single_set_selected_text(item.text);}
if(!((evt.metaKey||evt.ctrlKey)&&this.is_multiple)){this.results_hide();}
this.search_field.value="";if(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex){Events.fire(this.form_field,"change",{'selected':this.form_field.options[item.options_index].value});}
this.current_selectedIndex=this.form_field.selectedIndex;return this.search_field_scale();}};Chosen.prototype.single_set_selected_text=function(text){if(text==null){text=this.default_text;}
if(text===this.default_text){DOM.add_class(this.selected_item,"chzn-default");}else{this.single_deselect_control_build();DOM.remove_class(this.selected_item,"chzn-default");}
return this.selected_item.getElementsByTagName("span")[0].textContent=text;};Chosen.prototype.result_deselect=function(pos){var result_data;result_data=this.results_data[pos];if(!this.form_field.options[result_data.options_index].disabled){result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;this.selected_option_count=null;this.result_clear_highlight();if(this.results_showing){this.winnow_results();}
Events.fire(this.form_field,"change",{deselected:this.form_field.options[result_data.options_index].value});this.search_field_scale();return true;}else{return false;}};Chosen.prototype.single_deselect_control_build=function(){var abbr,span;if(!this.allow_single_deselect){return;}
if(this.selected_item.getElementsByTagName("abbr").length===0){span=this.selected_item.getElementsByTagName('span')[0];abbr=document.createElement('abbr');abbr.className="search-choice-close";span.parentNode.insertBefore(abbr,span.nextSibling);}
return DOM.add_class(this.selected_item,"chzn-single-with-deselect");};Chosen.prototype.get_search_text=function(){if(this.search_field.value===this.default_text){return "";}else{temp_el=document.createElement("div");temp_el.textContent=Util.trim(this.search_field.value);return temp_el.innerHTML;}};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;selected_results=!this.is_multiple?this.search_results.querySelectorAll(".result-selected.active-result"):[];do_high=selected_results.length?selected_results[0]:this.search_results.querySelector(".active-result");if(do_high!=null){return this.result_do_highlight(do_high);}};Chosen.prototype.no_results=function(terms){var li,span;li=document.createElement('li');li.className='no-results';li.innerHTML=this.results_none_found+' ';span=document.createElement('span');span.textContent=terms;li.appendChild(span);return this.search_results.appendChild(li);};Chosen.prototype.no_results_clear=function(){var no_results;no_results=this.search_results.querySelector(".no-results");if(no_results!=null){return no_results.parentNode.removeChild(no_results);}};Chosen.prototype.keydown_arrow=function(){var next_sib,_this=this;if(this.results_showing&&this.result_highlight){next_sib=DOM.find_next_sibling(this.result_highlight,function(el){return el.nodeName.toUpperCase()==="LI"&&DOM.has_class(el,"active-result");});if(next_sib){return this.result_do_highlight(next_sib);}}else{return this.results_show();}};Chosen.prototype.keyup_arrow=function(){var prev_sib,_this=this;if(!this.results_showing&&!this.is_multiple){return this.results_show();}else if(this.result_highlight){prev_sib=DOM.find_prev_sibling(this.result_highlight,function(el){return el.nodeName.toUpperCase()==="LI"&&DOM.has_class(el,"active-result");});if(prev_sib!=null){return this.result_do_highlight(prev_sib);}else{if(this.choices_count()>0){this.results_hide();}
return this.result_clear_highlight();}}};Chosen.prototype.keydown_backstroke=function(){var next_available_destroy,next_available_destroys;if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.getElementsByTagName("a")[0]);return this.clear_backstroke();}else{next_available_destroys=this.search_container.parentNode.querySelectorAll("li.search-choice");if(next_available_destroys.length){next_available_destroy=next_available_destroys[next_available_destroys.length-1];if(!DOM.has_class(next_available_destroy,"search-choice-disabled")){this.pending_backstroke=next_available_destroy;if(this.single_backstroke_delete){return this.keydown_backstroke();}else{return DOM.add_class(this.pending_backstroke,"search-choice-focus");}}}}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){DOM.remove_class(this.pending_backstroke,"search-choice-focus");}
return this.pending_backstroke=null;};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref1;stroke=(_ref1=evt.which)!=null?_ref1:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke();}
switch(stroke){case 8:this.backstroke_length=this.search_field.value.length;break;case 9:if(this.results_showing&&!this.is_multiple){this.result_select(evt);}
this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:evt.preventDefault();this.keydown_arrow();break;}};Chosen.prototype.search_field_scale=function(){var div,f_width,h,style,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;styles=['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'];div=document.createElement('div');div.style.position='absolute';div.style.left='-1000px';div.style.top='-1000px';for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];div.style[Util.camel_case(style)]=this.search_field.style[style];}
div.appendChild(document.createTextNode(this.search_field.value));document.body.appendChild(div);w=div.offsetWidth+25;div.parentNode.removeChild(div);f_width=this.container.outerWidth;if(w>f_width-10){w=f_width-10;}
return this.search_field.style.width=w+'px';}};return Chosen;})(AbstractChosen);}).call(this);